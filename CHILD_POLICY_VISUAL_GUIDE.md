# Child Policy - Visual Implementation Guide

## ğŸ¯ What We Built

A complete child policy system that:
1. Captures child ages in the UI
2. Validates ages before submission
3. Calculates pricing server-side
4. **Saves ages to database for verification**

---

## ğŸ“± Frontend User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: User Opens Availability Page                      â”‚
â”‚  /availability?id=standard-room                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Configure Booking                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Date: 2026-02-10                    â”‚                   â”‚
â”‚  â”‚ Time: 14:00                         â”‚                   â”‚
â”‚  â”‚ Duration: 3 hours                   â”‚                   â”‚
â”‚  â”‚ Adults: 2                           â”‚                   â”‚
â”‚  â”‚                                     â”‚                   â”‚
â”‚  â”‚ Children (0-13 years)               â”‚                   â”‚
â”‚  â”‚ [ - ] [ 0 ] [ + ]  â† Counter        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: User Clicks "+" to Add Children                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Children (0-13 years)               â”‚                   â”‚
â”‚  â”‚ [ - ] [ 2 ] [ + ]  Max 2 children   â”‚                   â”‚
â”‚  â”‚                                     â”‚                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚  â”‚ â”‚ Child Ages                      â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ Ages 0-6: Free | Ages 7-13:    â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ +â‚±150 per child                 â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚                                 â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ Child 1 Age                     â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ [  8 years old  â–¼]              â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚                                 â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ Child 2 Age                     â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ [ 12 years old  â–¼]              â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚                                 â”‚ â”‚                   â”‚
â”‚  â”‚ â”‚ Child Surcharge: +â‚±300          â”‚ â”‚                   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Price Updates Automatically                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Total Rate: â‚±1,500                  â”‚                   â”‚
â”‚  â”‚ Base: â‚±1,200 + Child: â‚±300          â”‚                   â”‚
â”‚  â”‚                                     â”‚                   â”‚
â”‚  â”‚ Duration: 3 Hours                   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: User Clicks "Check Availability"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Room Available â†’ User Clicks "Book Now"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: Frontend Validation                               â”‚
â”‚  âœ… Check: childAges.length === children (2 === 2)         â”‚
â”‚  âœ… Check: All ages are 0-13                               â”‚
â”‚  âœ… Check: No NaN values                                   â”‚
â”‚  âœ… PASS â†’ Navigate to booking page                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BOOKING PAGE                                               â”‚
â”‚  Query params:                                              â”‚
â”‚  - adults: 2                                                â”‚
â”‚  - children: 2                                              â”‚
â”‚  - childAges: "8,12"  â† Comma-separated                    â”‚
â”‚  - price: 1500                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Backend Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REQUEST RECEIVED                                           â”‚
â”‚  POST /api/payment/create-checkout                         â”‚
â”‚  {                                                          â”‚
â”‚    guestInfo: {                                             â”‚
â”‚      adults: 2,                                             â”‚
â”‚      children: 2,                                           â”‚
â”‚      childAges: "8,12"                                      â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Extract & Parse (Lines 345-353)                   â”‚
â”‚  adultsCount = parseInt(guestInfo.adults) || 1              â”‚
â”‚  childrenCount = parseInt(guestInfo.children) || 0          â”‚
â”‚  childAges = []                                             â”‚
â”‚  childAddOnPrice = 0                                        â”‚
â”‚                                                              â”‚
â”‚  Result:                                                     â”‚
â”‚  adultsCount = 2                                            â”‚
â”‚  childrenCount = 2                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Validate Counts (Lines 355-368)                   â”‚
â”‚  âœ… adultsCount: 1 â‰¤ 2 â‰¤ 4                                 â”‚
â”‚  âœ… childrenCount: 0 â‰¤ 2 â‰¤ 2                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Parse Child Ages (Lines 370-396)                  â”‚
â”‚  childAges = "8,12".split(',')                              â”‚
â”‚             .map(age => parseInt(age.trim()))               â”‚
â”‚             .filter(age => !isNaN(age))                     â”‚
â”‚                                                              â”‚
â”‚  Result: childAges = [8, 12]                                â”‚
â”‚                                                              â”‚
â”‚  Validations:                                                â”‚
â”‚  âœ… childAges.length === childrenCount (2 === 2)           â”‚
â”‚  âœ… All ages 0-13                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Calculate Pricing (Lines 398-405)                 â”‚
â”‚  chargeableChildren = childAges.filter(                     â”‚
â”‚    age => age >= 7 && age <= 13                            â”‚
â”‚  ).length                                                    â”‚
â”‚                                                              â”‚
â”‚  Process:                                                    â”‚
â”‚  - Age 8: 7 â‰¤ 8 â‰¤ 13 â†’ âœ… Chargeable                       â”‚
â”‚  - Age 12: 7 â‰¤ 12 â‰¤ 13 â†’ âœ… Chargeable                     â”‚
â”‚                                                              â”‚
â”‚  chargeableChildren = 2                                     â”‚
â”‚  childAddOnPrice = 2 Ã— 150 = 300                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Final Price (Lines 410-418)                       â”‚
â”‚  baseRoomPrice = 1200 (from database)                       â”‚
â”‚  serverCalculatedPrice = 1200 + 300 = 1500                  â”‚
â”‚                                                              â”‚
â”‚  Console Log:                                                â”‚
â”‚  ğŸ‘¶ Child Policy Applied:                                   â”‚
â”‚     Total Children: 2                                       â”‚
â”‚     Ages: [8, 12]                                           â”‚
â”‚     Chargeable (7-13 years): 2                              â”‚
â”‚     Add-on Fee: â‚±300                                        â”‚
â”‚                                                              â”‚
â”‚  ğŸ’° Price Calculation:                                      â”‚
â”‚     Base Room Rate: â‚±1200                                   â”‚
â”‚     Child Add-on: â‚±300                                      â”‚
â”‚     Final Total: â‚±1500                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Save to Database (Line 503)                       â”‚
â”‚  Booking.create({                                           â”‚
â”‚    adults_count: 2,                                         â”‚
â”‚    children_count: 2,                                       â”‚
â”‚    child_ages: [8, 12],  â† âœ… JSON ARRAY SAVED!            â”‚
â”‚    total_amount: 1500.00                                    â”‚
â”‚  })                                                          â”‚
â”‚                                                              â”‚
â”‚  Console Log:                                                â”‚
â”‚  ğŸ“ Pending booking created: BKG-XXX-XXX                    â”‚
â”‚  ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Guests: 2 adult(s), 2 child(ren)                     â”‚
â”‚  ğŸ‘¶ Child Ages Saved: [8, 12]  â† âœ… CONFIRMATION            â”‚
â”‚  ğŸ’° Amount: â‚±1500                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Record Example

```sql
-- After successful booking
SELECT * FROM bookings 
WHERE reference_code = 'BKG-XXX-XXX';
```

**Result**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬
â”‚ booking_id â”‚ guest_id â”‚ room_id â”‚ reference_codeâ”‚ adults_count â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 123        â”‚ 45       â”‚ 5       â”‚ BKG-XXX-XXX   â”‚ 2            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ children_countâ”‚ child_ages â”‚ total_amount â”‚ status     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2             â”‚ [8, 12]    â”‚ 1500.00      â”‚ Confirmed  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Points**:
- âœ… `adults_count` = 2 (correct)
- âœ… `children_count` = 2 (correct)
- âœ… `child_ages` = `[8, 12]` (JSON array stored!)
- âœ… `total_amount` = 1500.00 (base 1200 + child 300)

---

## ğŸ” Staff Verification Example

### Scenario: Customer Disputes Child Charge

**Customer**: "Why was I charged â‚±1,500? The room is only â‚±1,200!"

**Staff Query**:
```sql
SELECT 
  reference_code,
  adults_count,
  children_count,
  child_ages,
  total_amount
FROM bookings
WHERE reference_code = 'BKG-XXX-XXX';
```

**Result**:
```
reference_code: BKG-XXX-XXX
adults_count: 2
children_count: 2
child_ages: [8, 12]
total_amount: 1500.00
```

**Staff Response**:
> "According to your booking record:
> - You booked for 2 adults and 2 children
> - Children's ages: 8 and 12 years old
> - Our policy: Children 7-13 years are charged â‚±150 each
> - Calculation: â‚±1,200 (base) + â‚±300 (2 children) = â‚±1,500
> - This is correct as per our child policy."

**Evidence**:
- âœ… Child ages saved in database
- âœ… Cannot be disputed
- âœ… Clear audit trail
- âœ… Policy correctly applied

---

## ğŸ“Š Pricing Matrix

| Adults | Children | Ages    | Base Price | Child Fee | Total   |
|--------|----------|---------|------------|-----------|---------|
| 2      | 0        | -       | â‚±1,200     | â‚±0        | â‚±1,200  |
| 2      | 1        | [5]     | â‚±1,200     | â‚±0        | â‚±1,200  |
| 2      | 1        | [8]     | â‚±1,200     | â‚±150      | â‚±1,350  |
| 2      | 2        | [3, 5]  | â‚±1,200     | â‚±0        | â‚±1,200  |
| 2      | 2        | [4, 9]  | â‚±1,200     | â‚±150      | â‚±1,350  |
| 2      | 2        | [8, 12] | â‚±1,200     | â‚±300      | â‚±1,500  |
| 1      | 2        | [7, 13] | â‚±1,200     | â‚±300      | â‚±1,500  |

**Legend**:
- Ages 0-6: Free (â‚±0)
- Ages 7-13: Charged (â‚±150 each)
- Max children: 2

---

## âœ… Implementation Checklist

### Database Migration
- [ ] Open phpMyAdmin or MySQL CLI
- [ ] Run `server/migrations/add_child_ages_column.sql`
- [ ] Verify column exists: `DESCRIBE bookings;`
- [ ] Confirm type is JSON

### Test Frontend
- [ ] Navigate to /availability?id=standard-room
- [ ] Set children to 2
- [ ] Verify 2 age dropdowns appear
- [ ] Select ages (e.g., 8 and 12)
- [ ] Verify price updates to base + â‚±300
- [ ] Try to proceed without selecting ages â†’ Should block
- [ ] Select all ages â†’ Should allow proceed

### Test Backend
- [ ] Check server console logs
- [ ] Verify "Child Policy Applied" message
- [ ] Verify "Child Ages Saved: [8, 12]" message
- [ ] Check PayMongo amount matches calculated total

### Test Database
- [ ] Create a test booking
- [ ] Query: `SELECT * FROM bookings ORDER BY created_at DESC LIMIT 1;`
- [ ] Verify `child_ages` contains JSON array
- [ ] Verify `children_count` matches array length
- [ ] Verify `total_amount` is correct

### Verification Queries
- [ ] Run `server/scripts/verify_child_ages.sql`
- [ ] Check all queries return expected results
- [ ] Verify data integrity check passes

---

## ğŸ‰ Success Indicators

You'll know everything works when:

1. **Frontend**: 
   - âœ… Age dropdowns appear for each child
   - âœ… Price updates with child surcharge
   - âœ… Validation blocks submission without ages

2. **Backend Console**:
   ```
   ğŸ‘¶ Child Policy Applied:
      Total Children: 2
      Ages: [8, 12]
      Chargeable (7-13 years): 2
      Add-on Fee: â‚±300

   ğŸ’° Price Calculation:
      Base Room Rate: â‚±1200
      Child Add-on: â‚±300
      Final Total: â‚±1500

   ğŸ‘¶ Child Ages Saved: [8, 12]
   ```

3. **Database**:
   ```sql
   SELECT child_ages FROM bookings 
   WHERE reference_code = 'BKG-XXX-XXX';
   
   -- Result: [8, 12]  â† JSON array!
   ```

4. **Staff Can Verify**:
   - View child ages for any booking
   - Confirm pricing is correct
   - Resolve disputes with data

---

## ğŸš€ You're Done!

The child policy implementation is **complete** with:
- âœ… UI for age selection
- âœ… Frontend validation
- âœ… Backend calculation
- âœ… **Database storage of ages**
- âœ… Staff verification capability
- âœ… Complete audit trail

**Deploy and test! ğŸŠ**
